<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDI Network ‚Äî Collaborative Distributed Inference</title>
    <meta name="description"
        content="100% browser-native decentralized AI inference network. Open this page to become a node. WebGPU + libp2p + OrbitDB.">
    <link rel="icon" type="image/png" href="docs/assets/logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-card: rgba(20, 20, 35, 0.85);
            --border: rgba(255, 255, 255, 0.06);
            --cyan: #00D4FF;
            --gold: #F7931A;
            --green: #00E676;
            --purple: #7B2FBE;
            --red: #FF5252;
            --text: #E8E8F0;
            --text2: #9090A8;
            --gradient: linear-gradient(135deg, var(--cyan), var(--purple));
            --gradient-gold: linear-gradient(135deg, var(--gold), var(--cyan));
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1,
        h2,
        h3,
        h4 {
            font-family: 'Space Grotesk', sans-serif;
        }

        /* ‚îÄ‚îÄ Background ‚îÄ‚îÄ */
        .bg-anim {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(123, 47, 190, 0.06) 0%, transparent 50%);
            z-index: -1;
        }

        /* ‚îÄ‚îÄ Nav ‚îÄ‚îÄ */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 14px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 15, 0.85);
            border-bottom: 1px solid var(--border);
            z-index: 100;
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
        }

        .nav-brand img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .nav-brand span {
            font-family: 'Space Grotesk';
            font-size: 1.2rem;
            font-weight: 600;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-links {
            display: flex;
            gap: 24px;
            align-items: center;
        }

        .nav-links a {
            color: var(--text2);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--cyan);
        }

        .nav-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            border-radius: 20px;
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid rgba(0, 230, 118, 0.3);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--green);
        }

        .nav-status .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            animation: pulse 2s infinite;
        }

        .nav-status.offline {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--text2);
        }

        .nav-status.offline .dot {
            background: var(--text2);
            animation: none;
        }

        /* ‚îÄ‚îÄ Hero (shown before connect) ‚îÄ‚îÄ */
        #hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 100px 20px 60px;
        }

        .hero-inner {
            max-width: 720px;
        }

        .hero-badge {
            display: inline-block;
            padding: 5px 14px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--cyan);
            margin-bottom: 20px;
        }

        #hero h1 {
            font-size: clamp(2.2rem, 5vw, 3.8rem);
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 20px;
        }

        #hero h1 .g {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #hero p {
            font-size: 1.1rem;
            color: var(--text2);
            max-width: 560px;
            margin: 0 auto 32px;
        }

        .hero-stats {
            display: flex;
            gap: 40px;
            justify-content: center;
            margin-top: 48px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-val {
            font-family: 'Space Grotesk';
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-lbl {
            font-size: 0.8rem;
            color: var(--text2);
            margin-top: 2px;
        }

        /* ‚îÄ‚îÄ Connect Button ‚îÄ‚îÄ */
        .btn-join {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 14px 36px;
            border-radius: 12px;
            background: var(--gradient-gold);
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 20px rgba(0, 180, 216, 0.25);
        }

        .btn-join:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 180, 216, 0.4);
        }

        .btn-join:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--cyan);
            padding: 14px 36px;
            border-radius: 12px;
            border: 1px solid rgba(0, 212, 255, 0.3);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: all 0.3s;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background: rgba(0, 212, 255, 0.08);
            border-color: var(--cyan);
        }

        /* ‚îÄ‚îÄ Dashboard (shown after connect) ‚îÄ‚îÄ */
        #dashboard {
            display: none;
            padding: 80px 20px 40px;
            max-width: 1100px;
            margin: 0 auto;
        }

        .dash-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 14px;
            margin-bottom: 24px;
        }

        .dash-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
            transition: border-color 0.3s;
        }

        .dash-card:hover {
            border-color: rgba(0, 212, 255, 0.2);
        }

        .dash-label {
            font-size: 0.7rem;
            color: var(--text2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .dash-val {
            font-size: 1.6rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .dash-val.gold {
            color: var(--gold);
        }

        .dash-val.cyan {
            color: var(--cyan);
        }

        .dash-val.green {
            color: var(--green);
        }

        .dash-val.purple {
            color: #B388FF;
        }

        .panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
        }

        .panel-hd {
            padding: 14px 18px;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
            font-weight: 600;
        }

        .panel-bd {
            padding: 16px 18px;
        }

        .panel.full {
            grid-column: 1/-1;
        }

        /* Identity rows */
        .id-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }

        .id-row:last-child {
            border-bottom: none;
        }

        .id-lbl {
            font-size: 0.7rem;
            color: var(--text2);
            width: 70px;
            flex-shrink: 0;
        }

        .id-val {
            font-family: 'JetBrains Mono';
            font-size: 0.78rem;
            word-break: break-all;
        }

        /* Log */
        .log {
            font-family: 'JetBrains Mono';
            font-size: 0.72rem;
            color: var(--text2);
            line-height: 1.9;
            max-height: 260px;
            overflow-y: auto;
        }

        .log .t {
            color: #555;
        }

        .log .i {
            color: var(--cyan);
        }

        .log .s {
            color: var(--green);
        }

        .log .w {
            color: var(--gold);
        }

        /* Inference */
        .infer-wrap {
            display: flex;
            gap: 10px;
            margin-bottom: 14px;
        }

        .infer-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 10px;
            background: rgba(10, 10, 20, 0.8);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: 'Inter';
            font-size: 0.85rem;
            outline: none;
        }

        .infer-input:focus {
            border-color: var(--cyan);
        }

        .btn-infer {
            padding: 12px 24px;
            border-radius: 10px;
            background: var(--gradient-gold);
            color: #fff;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }

        .infer-out {
            background: rgba(10, 10, 20, 0.8);
            border-radius: 10px;
            padding: 14px 18px;
            font-family: 'JetBrains Mono';
            font-size: 0.78rem;
            color: var(--text2);
            min-height: 80px;
            border: 1px solid var(--border);
        }

        /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .dash-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .panels {
                grid-template-columns: 1fr;
            }

            nav {
                padding: 10px 16px;
            }

            .nav-links {
                gap: 12px;
            }

            .hero-stats {
                gap: 20px;
            }
        }

        @media (max-width: 480px) {
            .dash-stats {
                grid-template-columns: 1fr;
            }
        }

        /* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.4;
            }
        }

        .anim {
            animation: fadeUp 0.5s ease both;
        }

        .anim-d1 {
            animation-delay: 0.1s;
        }

        .anim-d2 {
            animation-delay: 0.2s;
        }

        .anim-d3 {
            animation-delay: 0.3s;
        }
    </style>
</head>

<body>
    <div class="bg-anim"></div>

    <!-- Nav -->
    <nav>
        <a href="#" class="nav-brand">
            <img src="docs/assets/logo.png" alt="CDI">
            <span>CDI Network</span>
        </a>
        <div class="nav-links">
            <a href="https://github.com/cdi-network/cdi-network" target="_blank">GitHub</a>
            <a href="docs/WHITEPAPER.md">Whitepaper</a>
            <div class="nav-status offline" id="navStatus">
                <div class="dot"></div>
                <span id="navStatusText">Offline</span>
            </div>
        </div>
    </nav>

    <!-- Hero / Connect -->
    <section id="hero">
        <div class="hero-inner">
            <div class="hero-badge anim">‚ö° Testnet Live</div>
            <h1 class="anim anim-d1">AI Inference.<br><span class="g">In Your Browser.</span></h1>
            <p class="anim anim-d2">Open this page and your browser becomes a node in the CDI Network. No downloads, no
                servers. WebGPU runs inference on your GPU. libp2p connects you peer-to-peer.</p>
            <div class="anim anim-d3" style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap;">
                <button class="btn-join" id="btnJoin" onclick="joinNetwork()">üåê Join the Network</button>
                <a href="docs/WHITEPAPER.md" class="btn-secondary">üìÑ Whitepaper</a>
            </div>
            <div class="hero-stats anim anim-d3">
                <div class="stat">
                    <div class="stat-val">21M</div>
                    <div class="stat-lbl">Max Supply</div>
                </div>
                <div class="stat">
                    <div class="stat-val">40+</div>
                    <div class="stat-lbl">Models</div>
                </div>
                <div class="stat">
                    <div class="stat-val">85%</div>
                    <div class="stat-lbl">To Providers</div>
                </div>
                <div class="stat">
                    <div class="stat-val">ZK</div>
                    <div class="stat-lbl">Verified</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard">
        <div class="dash-stats">
            <div class="dash-card">
                <div class="dash-label">CDI Earned</div>
                <div class="dash-val gold" id="dEarnings">0.00</div>
            </div>
            <div class="dash-card">
                <div class="dash-label">Peers</div>
                <div class="dash-val cyan" id="dPeers">0</div>
            </div>
            <div class="dash-card">
                <div class="dash-label">Shards</div>
                <div class="dash-val green" id="dShards">0</div>
            </div>
            <div class="dash-card">
                <div class="dash-label">Uptime</div>
                <div class="dash-val purple" id="dUptime">00:00:00</div>
            </div>
        </div>

        <div class="panels">
            <!-- Identity -->
            <div class="panel">
                <div class="panel-hd">ü™™ Node Identity</div>
                <div class="panel-bd">
                    <div class="id-row"><span class="id-lbl">Peer ID</span><span class="id-val" id="idPeer">‚Äî</span>
                    </div>
                    <div class="id-row"><span class="id-lbl">ETH Addr</span><span class="id-val" id="idEth">‚Äî</span>
                    </div>
                    <div class="id-row"><span class="id-lbl">Pub Key</span><span class="id-val" id="idKey">‚Äî</span>
                    </div>
                </div>
            </div>

            <!-- Shards -->
            <div class="panel">
                <div class="panel-hd">üß© Active Shards</div>
                <div class="panel-bd" id="shardList">
                    <div style="color:var(--text2);text-align:center;padding:30px 0;font-size:0.85rem;">
                        Waiting for shard assignments‚Ä¶
                    </div>
                </div>
            </div>

            <!-- Log -->
            <div class="panel full">
                <div class="panel-hd">üìã Node Log</div>
                <div class="panel-bd">
                    <div class="log" id="logArea"></div>
                </div>
            </div>

            <!-- Inference -->
            <div class="panel full">
                <div class="panel-hd">ü§ñ Run Inference</div>
                <div class="panel-bd">
                    <div class="infer-wrap">
                        <input type="text" class="infer-input" id="inferIn"
                            placeholder="Enter prompt for distributed inference‚Ä¶">
                        <button class="btn-infer" onclick="submitInference()">Run</button>
                    </div>
                    <div class="infer-out" id="inferOut">Output will appear after distributed inference completes‚Ä¶</div>
                </div>
            </div>
        </div>
    </section>

    <script type="module">
        import {
            initWasm, loadOrCreateWallet, connectMetaMask,
            startNode, getNodeStatus, getStoredBinding,
            runInference, onNodeEvent
        } from './browser/cdi-node.js';

        // ‚îÄ‚îÄ Log helper ‚îÄ‚îÄ
        function log(msg, level = 'i') {
            const a = document.getElementById('logArea');
            const t = new Date().toLocaleTimeString();
            a.innerHTML += `<div><span class="t">[${t}]</span> <span class="${level}">${msg}</span></div>`;
            a.scrollTop = a.scrollHeight;
        }

        // ‚îÄ‚îÄ Live subsystem events ‚îÄ‚îÄ
        onNodeEvent((event, data) => {
            switch(event) {
                case 'wasm:ready': log('WASM ‚úì', 's'); break;
                case 'p2p:started': log('P2P (libp2p/WebRTC) ‚úì', 's'); break;
                case 'storage:ready': log('Helia (IPFS) + OrbitDB ‚úì', 's'); break;
                case 'compute:webgpu': log('WebGPU compute shaders ‚úì', 's'); break;
                case 'compute:cpu': log('CPU fallback (no WebGPU detected)', 'w'); break;
                case 'security:ready': log('Security (Rate/Reputation/Sybil/ZKP) ‚úì', 's'); break;
                case 'catalog:ready': log('Model Catalog ‚úì', 's'); break;
                case 'governance:ready': log('Governance ‚úì', 's'); break;
                case 'faucet:claimed': log(`Testnet reward: +${data.amount} CDI`, 's'); break;
                case 'peer:connected': log(`Peer: ${data.peerId?.slice(0,12)}‚Ä¶ (${data.total} total)`); break;
                case 'inference:start': log(`Inference ‚Üí "${data.prompt?.slice(0,40)}‚Ä¶"`); break;
                case 'inference:complete': log('Inference complete ‚úì', 's'); break;
                case 'node:ready':
                    log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 's');
                    log('ALL SUBSYSTEMS ONLINE', 's');
                    log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 's');
                    break;
            }
        });

        // ‚îÄ‚îÄ Auto-init on page load ‚îÄ‚îÄ
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await initWasm();
                const w = loadOrCreateWallet();
                log(`Ed25519 wallet: ${w.peerId.slice(0, 16)}‚Ä¶`);

                const binding = getStoredBinding();
                if (binding && window.ethereum) {
                    try {
                        const accs = await window.ethereum.request({ method: 'eth_accounts' });
                        if (accs.length > 0 && accs[0].toLowerCase() === binding.ethAddress.toLowerCase()) {
                            log('Reconnecting previous session‚Ä¶');
                            await doConnect(w, true);
                            return;
                        }
                    } catch(e) { /* no auto */ }
                }
            } catch(e) {
                log('Init: ' + e.message, 'w');
            }
        });

        // ‚îÄ‚îÄ Join Network ‚îÄ‚îÄ
        window.joinNetwork = async function() {
            const btn = document.getElementById('btnJoin');
            btn.disabled = true;
            btn.textContent = 'Initializing subsystems‚Ä¶';
            try {
                await initWasm();
                const w = loadOrCreateWallet();
                await doConnect(w, false);
            } catch(e) {
                log('Connect failed: ' + e.message, 'w');
                btn.disabled = false;
                btn.textContent = 'üåê Join the Network';
            }
        };

        async function doConnect(walletInfo, isAuto) {
            if (!isAuto) {
                const binding = await connectMetaMask();
                log('MetaMask bound: ' + binding.ethAddress.slice(0,10) + '‚Ä¶', 's');
            } else {
                await connectMetaMask();
            }
            // startNode() bootstraps ALL subsystems:
            // P2P ‚Üí Helia ‚Üí WebGPU ‚Üí Security ‚Üí Catalog ‚Üí Pipeline ‚Üí Governance ‚Üí Testnet
            await startNode();
            showDashboard(walletInfo);
        }

        function showDashboard(w) {
            document.getElementById('hero').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('navStatus').classList.remove('offline');
            document.getElementById('navStatusText').textContent = 'Node Active';

            const binding = getStoredBinding();
            document.getElementById('idPeer').textContent = w.peerId;
            document.getElementById('idEth').textContent = binding?.ethAddress || '‚Äî';
            document.getElementById('idKey').textContent = w.publicKey;

            // Live stats refresh
            setInterval(() => {
                const s = getNodeStatus();
                document.getElementById('dEarnings').textContent = s.earnings.toFixed(2);
                document.getElementById('dPeers').textContent = s.peers;
                document.getElementById('dShards').textContent = s.shards;
                const h = String(Math.floor(s.uptime/3600)).padStart(2,'0');
                const m = String(Math.floor((s.uptime%3600)/60)).padStart(2,'0');
                const sec = String(s.uptime%60).padStart(2,'0');
                document.getElementById('dUptime').textContent = `${h}:${m}:${sec}`;
            }, 1000);
        }

        // ‚îÄ‚îÄ Inference ‚Äî uses full distributed pipeline ‚îÄ‚îÄ
        window.submitInference = async function() {
            const input = document.getElementById('inferIn');
            const output = document.getElementById('inferOut');
            const prompt = input.value.trim();
            if (!prompt) return;
            output.textContent = 'Distributing across network shards‚Ä¶';
            try {
                const result = await runInference(prompt);
                output.textContent = result?.output || JSON.stringify(result);
            } catch(e) {
                output.textContent = 'Error: ' + e.message;
                log('Inference error: ' + e.message, 'w');
            }
        };
    </script>
</body>

</html>